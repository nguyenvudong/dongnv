<!DOCTYPE html>
<html>
<head>
  <title>GPIO23 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <canvas id="gpioChart" width="600" height="300"></canvas>

  <script>
    const dataPoints = [];
    const labels = [];
    const maxPoints = 5;

    const ctx = document.getElementById('gpioChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'GPIO23',
          data: dataPoints,
          borderColor: 'blue',
          fill: false
        }]
      },
      options: {
        animation: false,
        scales: { y: { min: 0, max: 1 } }
      }
    });

    const client = mqtt.connect('wss://YOUR_EMQX_DOMAIN:8084', {
      username: 'dashboard',
      password: '123456'
    });

    client.on('connect', () => {
      client.subscribe('esp32/gpio23');
    });

    client.on('message', (topic, message) => {
      const value = parseInt(message.toString());
      const time = new Date().toLocaleTimeString();

      if (dataPoints.length >= maxPoints) {
        dataPoints.shift();
        labels.shift();
      }

      dataPoints.push(value);
      labels.push(time);

      chart.update();
    });
  </script>
</body>
</html>
